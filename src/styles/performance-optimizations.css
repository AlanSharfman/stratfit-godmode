/* src/styles/performance-optimizations.css */
/* STRATFIT — Performance Optimizations for Smooth UI */
/* Reduces jitter, improves animation smoothness, and optimizes rendering */

/* ============================================================================
   CRITICAL: REDUCE INFINITE ANIMATIONS
   Many animations are running infinitely causing constant GPU work
   ============================================================================ */

/* Pause non-essential infinite animations when not hovered */
.kpi-instrument:not(:hover),
.kpi-card:not(:hover) {
  animation-play-state: paused !important;
}

/* Only animate status indicators when computing */
.status-dot:not(.computing) {
  animation: none !important;
}

/* Reduce LED pulse frequency - too fast causes jitter */
[class*="led-"],
[class*="pulse"],
[class*="glow"] {
  animation-duration: 4s !important;
}

/* Disable expensive shimmer animations */
[class*="shimmer"]:not(:hover) {
  animation: none !important;
}

/* Simplify radar animations - these are expensive */
[class*="radar"] {
  animation-duration: 4s !important;
}

/* ============================================================================
   GPU ACCELERATION — Force hardware acceleration on animated elements
   ============================================================================ */

/* Main animated containers - promote to their own layer */
.kpi-instrument,
.kpi-sparkline-section,
.telemetry-strip,
.command-bridge,
.sf-mountain-stage,
.pro-slider,
.pro-fill,
.pro-thumb,
.valuation-gauge,
.decision-matrix,
.risk-radar {
  will-change: transform, opacity;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Prevent layout thrashing on frequently-changing elements */
.sparkline-path,
.gauge-needle,
.progress-bar,
.bar-fill,
.magnitude-fill,
.confidence-fill,
.driver-bar-fill,
.score-fill {
  will-change: transform;
  transform-origin: left center;
}

/* ============================================================================
   CONTAIN — Isolate rendering for better performance
   ============================================================================ */

/* Isolate layout calculations to specific containers */
.sf-center-root,
.valuation-tab,
.decision-tab,
.risk-tab,
.compare-tab,
.tradeoffs-tab {
  contain: layout style;
}

/* Full isolation for cards and panels */
.kpi-card,
.simulation-item,
.decision-card,
.matrix-card,
.timeline-card,
.list-item,
.exit-item,
.table-row {
  contain: layout style paint;
}

/* ============================================================================
   REDUCE ANIMATION COMPLEXITY — Simplify expensive animations
   ============================================================================ */

/* Reduce box-shadow animation complexity */
@media (prefers-reduced-motion: no-preference) {
  /* Simpler pulse animations */
  .kpi-instrument {
    animation: none !important;
  }
  
  .kpi-instrument:hover {
    transition: transform 150ms ease, box-shadow 200ms ease;
    transform: translateY(-2px) translateZ(0);
  }
  
  .kpi-instrument.active {
    transition: transform 150ms ease, box-shadow 200ms ease;
  }
}

/* ============================================================================
   SMOOTH TRANSITIONS — Use transform instead of layout properties
   ============================================================================ */

/* Progress bars - use scaleX instead of width */
.optimized-progress {
  transform: scaleX(var(--progress, 0));
  transform-origin: left;
  transition: transform 300ms cubic-bezier(0.4, 0, 0.2, 1);
  width: 100% !important;
}

/* Bar charts - use scaleY instead of height */
.optimized-bar {
  transform: scaleY(var(--height, 0));
  transform-origin: bottom;
  transition: transform 300ms cubic-bezier(0.4, 0, 0.2, 1);
  height: 100% !important;
}

/* ============================================================================
   SLIDER SMOOTHNESS — Debounce visual updates
   ============================================================================ */

.pro-track {
  /* Ensure smooth pointer tracking */
  touch-action: none;
  -webkit-touch-callout: none;
}

.pro-fill,
.pro-thumb {
  /* Smooth transitions when not dragging */
  transition: none;
}

/* Only add transition when not actively dragging */
.pro-slider:not(:active) .pro-fill,
.pro-slider:not(:active) .pro-thumb {
  transition: left 50ms linear, width 50ms linear;
}

/* ============================================================================
   REDUCE REPAINTS — Minimize expensive operations
   ============================================================================ */

/* Avoid animating box-shadow - use pseudo-element instead */
.glow-on-hover {
  position: relative;
}

.glow-on-hover::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  opacity: 0;
  box-shadow: 0 0 20px rgba(34, 211, 238, 0.5);
  transition: opacity 200ms ease;
  pointer-events: none;
  will-change: opacity;
}

.glow-on-hover:hover::after {
  opacity: 1;
}

/* ============================================================================
   OFFSCREEN OPTIMIZATION — Skip rendering for hidden elements
   ============================================================================ */

/* Hide elements that are not visible */
[data-view]:not([data-view="active"]) {
  content-visibility: hidden;
}

/* Lazy render lists */
.simulation-list,
.decision-list,
.comparables-table .table-body {
  content-visibility: auto;
  contain-intrinsic-size: auto 500px;
}

/* ============================================================================
   ANIMATION PERFORMANCE — Use compositor-only properties
   ============================================================================ */

/* Replace width animations with transform */
.bar-fill,
.range-fill,
.waterfall-step .bar-before,
.waterfall-step .bar-after {
  transition: transform 300ms ease !important;
}

/* Ensure SVG animations are smooth */
svg path,
svg line,
svg circle {
  vector-effect: non-scaling-stroke;
}

/* ============================================================================
   REDUCE FILTER COMPLEXITY — Simplify expensive filters
   ============================================================================ */

/* Reduce drop-shadow complexity during animations */
@media (prefers-reduced-motion: no-preference) {
  .telemetry-strip *,
  .command-bridge * {
    filter: none !important;
  }
  
  /* Only apply filters to specific elements when needed */
  .hex-core-reactor,
  .reactor-core {
    filter: drop-shadow(0 0 8px currentColor);
  }
}

/* ============================================================================
   SCROLL PERFORMANCE — Optimize scrolling areas
   ============================================================================ */

.modal-body,
.list-content,
.timeline-track,
.comparables-table,
.decision-content,
.valuation-content {
  overflow-y: auto;
  overscroll-behavior: contain;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

/* ============================================================================
   TEXT RENDERING — Optimize text performance
   ============================================================================ */

body {
  text-rendering: optimizeSpeed;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Only use optimizeLegibility for headings */
h1, h2, h3, .header-title, .modal-title {
  text-rendering: optimizeLegibility;
}

/* ============================================================================
   REDUCE MOTION — Respect user preferences
   ============================================================================ */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* ============================================================================
   LAYOUT STABILITY — Prevent layout shifts
   ============================================================================ */

/* Reserve space for dynamic content */
.kpi-value,
.stat-value,
.badge-value,
.metric-value,
.card-value {
  min-width: 3ch;
  font-variant-numeric: tabular-nums;
}

/* Prevent font loading shift */
.header-title,
.modal-title,
.section-title {
  font-display: swap;
}

/* Fixed dimensions for common elements */
.stat-badge,
.priority-badge,
.status-badge {
  min-width: fit-content;
  white-space: nowrap;
}

/* ============================================================================
   POINTER EVENTS — Prevent accidental interactions during animations
   ============================================================================ */

.sf-mountain-stage:active,
.pro-track:active {
  pointer-events: auto;
}

/* During view transitions, disable pointer events briefly */
[data-view-transitioning="true"] * {
  pointer-events: none !important;
}

/* ============================================================================
   COMPOSITE LAYER HINTS — Help browser optimize
   ============================================================================ */

/* Force layer creation for frequently animated elements */
.kpi-sparkline-section,
.telemetry-strip,
.command-bridge,
.hex-core-reactor {
  isolation: isolate;
}

/* ============================================================================
   PAINT CONTAINMENT — Reduce paint areas
   ============================================================================ */

/* Contain paint to specific regions */
.simulation-modal-content,
.decision-detail,
.valuation-gauge,
.comparables-benchmark {
  contain: paint;
}

/* ============================================================================
   ANIMATION TIMING — Use performant easing functions
   ============================================================================ */

/* Prefer linear or simple easing for frequent animations */
.pro-fill,
.pro-thumb,
.bar-fill,
.progress-fill {
  transition-timing-function: linear !important;
}

/* ============================================================================
   VISIBILITY OPTIMIZATION — Skip work for hidden content
   ============================================================================ */

/* Don't animate elements that aren't visible */
[hidden],
[aria-hidden="true"],
.hidden {
  animation: none !important;
  transition: none !important;
}

/* ============================================================================
   DEBUG — Performance markers (remove in production)
   ============================================================================ */

/* Uncomment to visualize layers:
* {
  outline: 1px solid rgba(255, 0, 0, 0.1);
}
*/

